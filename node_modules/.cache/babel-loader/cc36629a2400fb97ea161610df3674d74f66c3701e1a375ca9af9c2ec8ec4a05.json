{"ast":null,"code":"// ANITA Finance Advisor - Supabase Client\n// This file provides the Supabase client for direct database operations\nimport{createClient}from'@supabase/supabase-js';const supabaseUrl='https://kzregiqxflrvaxytdet.supabase.co';const supabaseAnonKey='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtlenJlZ2lxZnhscnZheHl0ZGV0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc2OTY5MTgsImV4cCI6MjA3MzI3MjkxOH0.X4QWu0W31Kv_8KGQ6h_n4PYnQOMTX85CYbWJVbv2AxM';export const supabase=createClient(supabaseUrl,supabaseAnonKey);// Transaction operations\nexport async function saveTransaction(transaction,userId){const{data,error}=await supabase.from('transactions').insert([{user_id:userId,type:transaction.type,amount:transaction.amount,category:transaction.category,description:transaction.description}]).select();if(error){console.error('Supabase insert error:',error);throw error;}return data;}export async function fetchTransactions(userId){const{data,error}=await supabase.from('transactions').select('*').eq('user_id',userId).order('created_at',{ascending:false});if(error){console.error('Supabase fetch error:',error);throw error;}return data||[];}export async function saveMessage(message,userId){const{data,error}=await supabase.from('messages').insert([{user_id:userId,content:message.content,message_type:message.message_type}]).select();if(error){console.error('Supabase message insert error:',error);throw error;}return data;}export async function fetchMessages(userId){const{data,error}=await supabase.from('messages').select('*').eq('user_id',userId).order('created_at',{ascending:true});if(error){console.error('Supabase messages fetch error:',error);throw error;}return data||[];}export async function getOrCreateDefaultUser(){// First try to get existing default user\nconst{data:existingUser,error:fetchError}=await supabase.from('users').select('*').eq('username','default_user').single();if(existingUser&&!fetchError){return existingUser;}// Create new default user if none exists\nconst{data:newUser,error:createError}=await supabase.from('users').insert([{username:'default_user',email:'default@anita.com',display_name:'Default User'}]).select().single();if(createError){console.error('Error creating default user:',createError);throw createError;}return newUser;}// Real-time subscription helper\nexport function subscribeToTransactions(userId,callback){const channel=supabase.channel('public:transactions').on('postgres_changes',{event:'INSERT',schema:'public',table:'transactions',filter:\"user_id=eq.\".concat(userId)},payload=>{console.log('New transaction received:',payload.new);callback(payload.new);}).subscribe();return()=>{supabase.removeChannel(channel);};}","map":{"version":3,"names":["createClient","supabaseUrl","supabaseAnonKey","supabase","saveTransaction","transaction","userId","data","error","from","insert","user_id","type","amount","category","description","select","console","fetchTransactions","eq","order","ascending","saveMessage","message","content","message_type","fetchMessages","getOrCreateDefaultUser","existingUser","fetchError","single","newUser","createError","username","email","display_name","subscribeToTransactions","callback","channel","on","event","schema","table","filter","concat","payload","log","new","subscribe","removeChannel"],"sources":["C:/Users/dzm13/anita-finance-advisor/src/supabaseClient.ts"],"sourcesContent":["// ANITA Finance Advisor - Supabase Client\r\n// This file provides the Supabase client for direct database operations\r\n\r\nimport { createClient } from '@supabase/supabase-js'\r\n\r\nconst supabaseUrl = 'https://kzregiqxflrvaxytdet.supabase.co'\r\nconst supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtlenJlZ2lxZnhscnZheHl0ZGV0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc2OTY5MTgsImV4cCI6MjA3MzI3MjkxOH0.X4QWu0W31Kv_8KGQ6h_n4PYnQOMTX85CYbWJVbv2AxM'\r\n\r\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey)\r\n\r\nexport interface Transaction {\r\n  id?: string;\r\n  user_id: string;\r\n  type: 'income' | 'expense';\r\n  amount: number;\r\n  category?: string;\r\n  description?: string;\r\n  created_at?: string;\r\n}\r\n\r\nexport interface Message {\r\n  id?: string;\r\n  user_id: string;\r\n  content: string;\r\n  message_type: 'user' | 'bot';\r\n  created_at?: string;\r\n}\r\n\r\n// Transaction operations\r\nexport async function saveTransaction(transaction: Omit<Transaction, 'id' | 'created_at'>, userId: string) {\r\n  const { data, error } = await supabase\r\n    .from('transactions')\r\n    .insert([{\r\n      user_id: userId,\r\n      type: transaction.type,\r\n      amount: transaction.amount,\r\n      category: transaction.category,\r\n      description: transaction.description\r\n    }])\r\n    .select();\r\n  \r\n  if (error) {\r\n    console.error('Supabase insert error:', error);\r\n    throw error;\r\n  }\r\n  \r\n  return data;\r\n}\r\n\r\nexport async function fetchTransactions(userId: string): Promise<Transaction[]> {\r\n  const { data, error } = await supabase\r\n    .from('transactions')\r\n    .select('*')\r\n    .eq('user_id', userId)\r\n    .order('created_at', { ascending: false });\r\n  \r\n  if (error) {\r\n    console.error('Supabase fetch error:', error);\r\n    throw error;\r\n  }\r\n  \r\n  return data || [];\r\n}\r\n\r\nexport async function saveMessage(message: Omit<Message, 'id' | 'created_at'>, userId: string) {\r\n  const { data, error } = await supabase\r\n    .from('messages')\r\n    .insert([{\r\n      user_id: userId,\r\n      content: message.content,\r\n      message_type: message.message_type\r\n    }])\r\n    .select();\r\n  \r\n  if (error) {\r\n    console.error('Supabase message insert error:', error);\r\n    throw error;\r\n  }\r\n  \r\n  return data;\r\n}\r\n\r\nexport async function fetchMessages(userId: string): Promise<Message[]> {\r\n  const { data, error } = await supabase\r\n    .from('messages')\r\n    .select('*')\r\n    .eq('user_id', userId)\r\n    .order('created_at', { ascending: true });\r\n  \r\n  if (error) {\r\n    console.error('Supabase messages fetch error:', error);\r\n    throw error;\r\n  }\r\n  \r\n  return data || [];\r\n}\r\n\r\nexport async function getOrCreateDefaultUser() {\r\n  // First try to get existing default user\r\n  const { data: existingUser, error: fetchError } = await supabase\r\n    .from('users')\r\n    .select('*')\r\n    .eq('username', 'default_user')\r\n    .single();\r\n  \r\n  if (existingUser && !fetchError) {\r\n    return existingUser;\r\n  }\r\n  \r\n  // Create new default user if none exists\r\n  const { data: newUser, error: createError } = await supabase\r\n    .from('users')\r\n    .insert([{\r\n      username: 'default_user',\r\n      email: 'default@anita.com',\r\n      display_name: 'Default User'\r\n    }])\r\n    .select()\r\n    .single();\r\n  \r\n  if (createError) {\r\n    console.error('Error creating default user:', createError);\r\n    throw createError;\r\n  }\r\n  \r\n  return newUser;\r\n}\r\n\r\n// Real-time subscription helper\r\nexport function subscribeToTransactions(userId: string, callback: (transaction: Transaction) => void) {\r\n  const channel = supabase\r\n    .channel('public:transactions')\r\n    .on('postgres_changes', \r\n      { \r\n        event: 'INSERT', \r\n        schema: 'public', \r\n        table: 'transactions',\r\n        filter: `user_id=eq.${userId}`\r\n      }, \r\n      (payload) => {\r\n        console.log('New transaction received:', payload.new);\r\n        callback(payload.new as Transaction);\r\n      }\r\n    )\r\n    .subscribe();\r\n  \r\n  return () => {\r\n    supabase.removeChannel(channel);\r\n  };\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}